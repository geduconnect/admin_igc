<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Enquiry Form with Tracking</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      .form-container {
        max-width: 500px;
        margin: 40px auto;
        padding: 20px;
        box-shadow: 0 0 10px #ccc;
        background: white;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container">
      <div class="form-container">
        <h4 class="text-center mb-4">Submit Enquiry</h4>
        <form id="enquiry-form">
          <div class="form-group">
            <label for="name">Name:</label>
            <input class="form-control" id="name" name="name" required />
          </div>
          <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" name="email" required />
          </div>
          <div class="form-group">
            <label for="contact_number">Contact Number:</label>
            <input class="form-control" id="contact_number" name="contact_number" required />
          </div>
          <div class="form-group">
            <label for="gender">Gender:</label>
            <select class="form-control" id="gender" name="gender" required>
              <option value="" disabled selected>Choose...</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>
          <div class="form-group">
            <label for="message">Message:</label>
            <textarea class="form-control" id="message" name="message" required></textarea>
          </div>
          <div class="form-group form-check">
            <input class="form-check-input" type="checkbox" id="age" name="age" />
            <label for="age" class="form-check-label">Over 18 years old</label>
          </div>
          <div class="form-group form-check">
            <input class="form-check-input" type="checkbox" id="ex" name="ex" required />
            <label for="ex" class="form-check-label">Agree with terms and policies</label>
          </div>
          <button type="submit" class="btn btn-primary btn-block">Submit</button>
        </form>
      </div>

      <div class="form-container mt-5">
        <h5 class="text-center mb-3">Track Your Enquiry</h5>
        <input class="form-control mb-2" id="enquiry-id" placeholder="Enter Enquiry ID" />
        <button id="track-btn" class="btn btn-info btn-block">Check Status</button>
        <div id="remark-result" class="mt-3 text-center"></div>
      </div>
    </div>

    <script>
      // Send form data to Apps Script backend
      const form = document.getElementById('enquiry-form');
      form.addEventListener('submit', e => {
        e.preventDefault();

        const formData = new FormData(form);
        const enquiryId = 'ENQ' + Date.now();
        formData.append('enquiry_id', enquiryId);

        // Convert checkbox to Yes/No
        formData.set('age', form.age.checked ? 'Yes' : 'No');
        formData.set('ex', form.ex.checked ? 'Yes' : 'No');

        // Prepare object to send
        const data = {};
        formData.forEach((value, key) => {
          data[key] = value;
        });

        google.script.run
          .withSuccessHandler(() => {
            Swal.fire('Success', `Your enquiry has been submitted! Your Enquiry ID is: <strong>${enquiryId}</strong>`, 'success');
            form.reset();
          })
          .withFailureHandler(() => {
            Swal.fire('Error', 'There was a problem submitting your enquiry. Please try again.', 'error');
          })
          .submitEnquiry(data);
      });

      // Track enquiry remark
      document.getElementById('track-btn').addEventListener('click', () => {
        const id = document.getElementById('enquiry-id').value.trim();
        if (!id) {
          alert('Please enter your Enquiry ID.');
          return;
        }

        google.script.run
          .withSuccessHandler((response) => {
            const remark = response.remark || 'No remarks yet.';
            document.getElementById('remark-result').innerHTML = `<strong>Status/Remarks:</strong><br>${remark}`;
          })
          .withFailureHandler(() => {
            document.getElementById('remark-result').innerHTML = 'Error fetching remark.';
          })
          .getRemarkById(id);
      });
    </script>
  </body>
</html>
